# 1.22 

## 优化版本分支 

受到大佬鼓舞，所以这里调出了一个新的优化版本分支。  
这个分支将会使用新的后端服务，所以就新增一个新的环境变量作为区分`improve_prod`。  
服务器的地址还有一些细节都会做改变，但是全部基于环境变量区分，不影响之前的功能，当然可能做一些阉割。  

目前能想到的变动的话：
- 新增新类型的实时保存方法。  
- 文件上传变为普通的上传。  
- 去除`mock`数据方法。  
- 新增一个`main-improve`主干分支来存放优化代码。  
- 内置背景选择可通过后端查询选择。  

## 图标选择优化
图标不再是之前的去官网自行查看，而是直接预备一份图标列表可以直接选择  
这里记录一下直接获取官网所有图标名称的方法
```js
  const arr = [] 
  $$('#icons-list li > a .name').forEach(item => {
    arr.push(item.innerText)
  })
  console.log(JSON.stringify(arr))
```

## 增加快照
新增了大屏快照，方便留存备份。  
目前只支持静态版本和`improve`版本。  
- `improve`   
  `improve`版本为与后端接口同步处理，将快照保存在后端数据库中，后续在**分享**的链接中，展示的将是当前使用的快照，而非实际最新更改的大屏。  
  预览还是和之前保持一致，使用最新更改的记录。  
- 静态版本  
  因为静态版本没有后端，所以考虑将数据保存在**缓存**中，因为静态版本没有分享，预览即是实际的生产环境链接，所以预览时，直接从缓存中拿到当前的快照进行展示。   
  并且为了防止数据过多导致内存不足，后续会考虑增加弹窗提示告知用户删除部分数据（不过现在因为同时只能存在一个大屏，所以目前不会出现刚刚说的情况）。  

## 关于静态版本的改动的想法  
按照之前的想法，数据全部留存在**本地**，那么在**预览**或者**分享**链接给他人时，就会出现打开页面没有数据。  
并且这个版本还增加了**快照**的功能，按照之前的逻辑会显的非常的鸡肋，所以在这里记录一下具体的改动流程。  
1. 首先在设计页面增加特殊的**引导**告知用户（尝试开启多个引导，帮助后续新增引导），如有完成的大屏的数据优先进行**导入**，再开始创作。  
2. `viewer`当前为预览和分享共页面的情况，但是当出现快照时，就会发生冲突（本意为预览，但是实际显示的可能是快照的内容--设计与展示不同步），所以将新增一个分享的页面，用于展示快照。  
3. 且根据上面`2`新增的**分享**页面，因为其功能性主要为分享，则使用该页面的用户大多为被别人分享了链接和数据文件，所以优先展示全屏的文件拖拽上传功能，告知上传该大屏数据。  
4. 根据上面`3`的功能，**分享**页增加一个参数（暂时只管他初始化的时候），是否需要展示文件上传界面（因为存在设计者本地查看的情况），且当发现未找到数据时，弹窗告知用户是否因为误填写了该参数导致未弹出上传界面。  
5. 设计页面增加一个展示生产环境大屏页面的按钮，帮助调试实际的生产环境，即分享页。  
6. 导入导出的数据的逻辑也需要更改，因为要同时导出大屏数据和快照的数据。数据格式如下展示  
  ```ts
    type JSON_DATA = {
      screenShot: API_IMPROVE.LocalScreenShotDataValue[]
      value: ComponentData.TScreenData
    }
  ```  